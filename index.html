<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ذكاء اصطناعي في المدرسة</title>
<style>
  /* ---- إعدادات عامة ---- */
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #0f111a;
    color: #e5e5e5;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  /* ---- حاوية الشات ---- */
  .chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* ---- فقاعات الرسائل ---- */
  .message {
    max-width: 70%;
    padding: 14px 18px;
    border-radius: 12px;
    line-height: 1.5;
    word-wrap: break-word;
    font-size: 14px;
    position: relative;
    animation: fadeIn 0.3s ease;
  }

  .user {
    align-self: flex-end;
    background-color: #1a73e8;
    border-bottom-right-radius: 0;
  }

  .bot {
    align-self: flex-start;
    background-color: #20232a;
    border-bottom-left-radius: 0;
  }

  /* ---- مؤشر البوت يكتب ---- */
  .typing-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .dot {
    width: 6px;
    height: 6px;
    background-color: #888;
    border-radius: 50%;
    animation: blink 1s infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes blink {
    0%, 80%, 100% { opacity: 0; }
    40% { opacity: 1; }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ---- حاوية الإدخال ---- */
  .input-container {
    display: flex;
    padding: 12px 16px;
    gap: 10px;
    background-color: #1a1c23;
    border-top: 1px solid #333;
  }

  .input-box {
    flex: 1;
    padding: 12px 16px;
    border-radius: 12px;
    border: none;
    background-color: #26292f;
    color: #e5e5e5;
    font-size: 15px;
    outline: none;
  }

  .send-btn {
    padding: 0 18px;
    border-radius: 12px;
    border: none;
    background-color: #1a73e8;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }
  .send-btn:hover { background-color: #155ab6; }

</style>
</head>
<body>

<div class="chat-container" id="chat"></div>

<div class="input-container">
  <input type="text" id="messageInput" class="input-box" placeholder="اكتب رسالتك واضغط Enter...">
  <button class="send-btn" id="sendBtn">إرسال</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
let botTyping = false;

function addMessage(text, sender, typingEffect=false) {
  const msg = document.createElement("div");
  msg.classList.add("message", sender);
  chat.appendChild(msg);
  chat.lastChild.scrollIntoView({behavior:"smooth"});

  if(sender === "bot" && typingEffect) {
    botTyping = true;
    input.disabled = true;
    sendBtn.disabled = true;

    const typingDiv = document.createElement("div");
    typingDiv.classList.add("typing-indicator");
    typingDiv.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
    msg.appendChild(typingDiv);

    let i = 0;
    const interval = setInterval(() => {
      if(i === 0) msg.textContent = ''; // إزالة مؤشر بعد البداية
      msg.textContent = text.slice(0,i);
      i++;
      chat.lastChild.scrollIntoView({behavior:"smooth"});
      if(i > text.length) {
        clearInterval(interval);
        botTyping = false;
        input.disabled = false;
        sendBtn.disabled = false;
      }
    }, 25);
  } else {
    msg.textContent = text;
  }
}

function sendMessage() {
  if(input.value.trim() === "" || botTyping) return;
  const userMessage = input.value;
  addMessage(userMessage, "user");
  input.value = "";

  fetch("/chat", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({message: userMessage})
  })
  .then(r => r.json())
  .then(d => addMessage(d.reply, "bot", true))
  .catch(() => addMessage("حدث خطأ في الاتصال بالسيرفر", "bot", true));
}

input.addEventListener("keydown", e => { if(e.key === "Enter") sendMessage(); });
sendBtn.addEventListener("click", sendMessage);
</script>

</body>
</html>
